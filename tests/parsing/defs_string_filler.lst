# file opened: defs_string_filler.asm
 1    0000              ; Test for Issue #149: Optional string-filler for DEFS directive
 2    0000              ; Tests operand parsing with mixed types, overflows, and device modes
 3    0000
 4    0000              ; ===== PIPE MODE (DEVICE NONE) =====
 5    0000                  DEVICE NONE
 6    0000
 7    0000                  ORG $0000
 8    0000
 9    0000              ; Case 1: DEFS without operands (default fill 0x00)
10    0000              test1
11    0000 00 00 00...      DEFS 5
12    0005
13    0005              ; Case 2: DEFS with single numeric operand (backward compat: DEFS 5, 0x42)
14    0005              test2
15    0005 42 42 42...      DEFS 5, 0x42
16    000A
17    000A              ; Case 3: DEFS with string operand (no suffix: DEFS 5, "A")
18    000A              test3
19    000A 41 41 41...      DEFS 5, "A"
20    000F
21    000F              ; Case 4: DEFS with longer suffixed string operand
22    000F              test4
23    000F 41 42 00 00      DEFS 10, "AB"Z
23    0013 00 00 00...
24    0019
25    0019              ; Case 5: DEFS with mixed operands (DEFS 10, 1, 'x', 3)
26    0019              test5
27    0019 01 78 03 03      DEFS 10, 1, 'x', 3
27    001D 03 03 03...
28    0023
29    0023              ; Case 6: DEFS with exact-fit operands (DEFS 3, 0x11, 0x22, 0x33)
30    0023              test6
31    0023 11 22 33         DEFS 3, 0x11, 0x22, 0x33
32    0026
33    0026              ; Case 7: DEFS with 129-byte operand list (tests GetBytes 128-byte limit)
34    0026              ; This should trigger GetBytes error "Over 128 bytes defined..."
35    0026              test7
defs_string_filler.asm(36): error: Over 128 bytes defined in single DB/DC/... Values over: @"
36    0026 41 42 43 44      DEFS 150, "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@"
36    002A 45 46 47 48
36    002E 49 4A 4B 4C
36    0032 4D 4E 4F 50
36    0036 51 52 53 54
36    003A 55 56 57 58
36    003E 59 5A 61 62
36    0042 63 64 65 66
36    0046 67 68 69 6A
36    004A 6B 6C 6D 6E
36    004E 6F 70 71 72
36    0052 73 74 75 76
36    0056 77 78 79 7A
36    005A 30 31 32 33
36    005E 34 35 36 37
36    0062 38 39 21 40
36    0066 5F 61 62 63
36    006A 64 65 66 67
36    006E 68 69 6A 6B
36    0072 6C 6D 6E 6F
36    0076 70 71 72 73
36    007A 74 75 76 77
36    007E 78 79 7A 41
36    0082 42 43 44 45
36    0086 46 47 48 49
36    008A 4A 4B 4C 4D
36    008E 4E 4F 50 51
36    0092 52 53 54 55
36    0096 56 57 58 59
36    009A 5A 30 31 32
36    009E 33 34 35 36
36    00A2 37 38 39 21
36    00A6 21 21 21...
37    00BC
38    00BC              ; Case 8: DEFS with operands exceeding DEFS size (DEFS 3, 1, 2, 3, 4, 5, 6)
39    00BC              ; Expected for DEFS: emit 1, 2, 3; truncate 4, 5, 6; use last byte (3) as filler; error
40    00BC              test8
defs_string_filler.asm(41): error: more init values provided than block size, amount of truncated bytes: 3
41    00BC 01 02 03         DEFS 3, 1, 2, 3, 4, 5, 6
42    00BF
43    00BF              ; Case 9: DEFS with string and numeric overflow (DEFS 2, "ABC", 0x44)
44    00BF              ; Expected for DEFS: emit 'A', 'B'; truncate 'C', 0x44; use last byte ('B'=0x42) as filler; error
45    00BF              test9
defs_string_filler.asm(46): error: more init values provided than block size, amount of truncated bytes: 2
46    00BF 41 42            DEFS 2, "ABC", 0x44
47    00C1
48    00C1              ; ===== DEVICE MODE (NOSLOT64K) ===== **** NEEDS UPDATE OF .LST FILE AFTER DEFS IS EXTENDED ****
49    00C1                  DEVICE NOSLOT64K
50    00C1
51    00C1                  ORG $4000
52    4000
53    4000              ; Case 10: DEFS without operands (device mode)
54    4000              test10
55    4000 00 00 00...      DEFS 5
56    4005
57    4005              ; Case 11: DEFS with mixed operands (device mode: DEFS 10, 1, 'x', 3)
58    4005              test11
defs_string_filler.asm(59): error: Unexpected: , 'x', 3
59    4005 01 01 01...      DEFS 10, 1, 'x', 3
60    400F
61    400F              ; Case 12: DEFS with exact-fit operands (device mode: DEFS 3, 0x11, 0x22, 0x33)
62    400F              test12
defs_string_filler.asm(63): error: Unexpected: , 0x22, 0x33
63    400F 11 11 11         DEFS 3, 0x11, 0x22, 0x33
64    4012
65    4012              ; Case 13: DEFS with operands exceeding size (device mode: DEFS 3, 1, 2, 3, 4, 5, 6)
66    4012              test13
defs_string_filler.asm(67): error: Unexpected: , 2, 3, 4, 5, 6
67    4012 01 01 01         DEFS 3, 1, 2, 3, 4, 5, 6
68    4015
69    4015              ; Comment: Cases testing C suffix (high-bit setting) can be added if implementation
70    4015              ; shows special handling needed. Currently trusting GetCharConstAsString() handles it.
71    4015              ; Cases for zero DEFS size or negative size not included - existing dirBLOCK already warns,
72    4015              ; should be covered by existing tests.
73    4015
74    4015                  END
# file closed: defs_string_filler.asm

Value    Label
------ - -----------------------------------------------------------
0x0000 X test1
0x4000 X test10
0x4005 X test11
0x400F X test12
0x4012 X test13
0x0005 X test2
0x000A X test3
0x000F X test4
0x0019 X test5
0x0023 X test6
0x0026 X test7
0x00BC X test8
0x00BF X test9
